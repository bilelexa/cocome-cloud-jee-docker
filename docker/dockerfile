


FROM java:8-jdk

MAINTAINER Niko Benkler and Tobias Ha√überg

# Set environment variables

ENV JAVA_HOME /usr/lib/jvm/java-8-openjdk-amd64 \
    PASSWORD=password


RUN \
    apt-get update && \
    apt-get install -y dos2unix && \
    apt-get install -y git



#clone git project from url
RUN git clone https://github.com/cocome-community-case-study/cocome-cloud-jee-docker.git usr/src/


ADD startdomain.sh /startdomain.sh 
ADD stopdomain.sh /stopdomain.sh  
ADD startafterstop.sh /startafterstop.sh

#changeFromat and uninstall dos2unix
RUN dos2unix /startdomain.sh && \
    dos2unix /startafterstop.sh && \
    dos2unix /stopdomain.sh && apt-get --purge remove -y dos2unix && rm -rf /var/lib/apt/lists/

#Make the scripts executable 
RUN chmod +x /*.sh



ADD web8048.war   \
 	store8148.ear   \
 	adapter8248.ear  \
 	enterprise8348.ear   \
	registry8448.war /usr/src/ 


RUN rm usr/src/*.md  && \
	rm -r usr/src/docker && \
	rm usr/src/glassfish/README.md

# 4848 (administration), 8080 (HTTP listener), 8181 (HTTPS listener)
EXPOSE 8048 8080 8081 8148 8180 8181 8248 8280 8281 8348 8380 8381 8448 8480 8481

CMD ["/startdomain.sh"]


